<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Cosmic Quest v8</title>
    <style>
        body {
            background: #0a0a1a;
            color: #00d4ff;
            font-family: Arial;
            text-align: center;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #00d4ff;
            color: black;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #00aaff;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(8, 50px);
            gap: 5px;
            margin: 20px auto;
            width: fit-content;
        }
        .hex {
            width: 50px;
            height: 50px;
            background: #1a3a5a;
            border: 2px solid #00d4ff;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
        }
        .hex:hover {
            background: #2a5a7a;
        }
        .hex.valido {
            background: #00ff41;
            border-color: #00ff41;
        }
        .hex.obstaculo {
            background: #444;
            border-color: #666;
        }
        .hex.destino {
            background: #ffbe0b;
            border-color: #ffbe0b;
        }
        .info {
            padding: 10px;
            background: rgba(0, 212, 255, 0.2);
            margin: 10px 0;
            border-radius: 5px;
            min-height: 20px;
        }
        .status {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: rgba(131, 56, 236, 0.3);
            border-radius: 5px;
            margin: 10px 0;
        }
        .resultado {
            padding: 20px;
            background: rgba(0, 212, 255, 0.3);
            border-radius: 5px;
            margin: 20px 0;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1>üöÄ COSMIC QUEST</h1>
    
    <div class="info">
        <p id="mensagem">Bem-vindo! Clique em JOGAR</p>
    </div>

    <div id="menu">
        <button onclick="comecarJogo()">JOGAR</button>
        <button onclick="mostrarAjuda()">AJUDA</button>
    </div>

    <div id="tela_jogo" style="display:none;">
        <div class="status">
            <div>üîµ Voc√™: <span id="pontos">0</span> | ‚úÖ <span id="vencidas_jogador">0</span>/3</div>
            <div>Turno: <span id="turno">VOC√ä</span></div>
            <div>üî¥ IA: <span id="pontos_ia">0</span> | ‚úÖ <span id="vencidas_ia">0</span>/3</div>
        </div>
        <div id="tabuleiro" class="board"></div>
        <button onclick="voltarMenu()">VOLTAR</button>
    </div>

    <div id="tela_ajuda" style="display:none;">
        <h2>Como Jogar</h2>
        <p><strong>OBJETIVO:</strong> Mova suas 3 pe√ßas azuis üîµ at√© o canto superior direito (‚≠ê)</p>
        <p><strong>COMO:</strong> Clique em uma pe√ßa AZUL, depois em um hex√°gono VERDE para mover</p>
        <p><strong>MOVIMENTO:</strong> Cada pe√ßa se move 1-3 casas. Rochas ü™® bloqueiam o caminho!</p>
        <p><strong>VIT√ìRIA:</strong> Leve suas 3 pe√ßas diferentes ao destino antes da IA!</p>
        <p><strong>PE√áAS NA ESTRELA:</strong> Quando sua pe√ßa chegar √† estrela, ela fica l√° protegida! (‚≠êüîµ)</p>
        <button onclick="voltarMenu()">VOLTAR</button>
    </div>

    <div id="tela_resultado" style="display:none;">
        <h1 id="titulo_resultado"></h1>
        <div class="resultado" id="texto_resultado"></div>
        <button onclick="comecarJogo()">JOGAR NOVAMENTE</button>
        <button onclick="voltarMenu()">MENU</button>
    </div>

    <script>
        let jogo = {
            peca_selecionada: null,
            movimentos_validos: [],
            pontos_jogador: 0,
            pontos_ia: 0,
            turno: 'jogador',
            pecas: [],
            hexagons: [],
            jogo_terminado: false,
            pecas_jogador_vencidas: 0,
            pecas_ia_vencidas: 0
        };

        function mostrarMensagem(texto) {
            document.getElementById('mensagem').textContent = texto;
        }

        function mostrarAjuda() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('tela_jogo').style.display = 'none';
            document.getElementById('tela_resultado').style.display = 'none';
            document.getElementById('tela_ajuda').style.display = 'block';
        }

        function voltarMenu() {
            document.getElementById('menu').style.display = 'block';
            document.getElementById('tela_jogo').style.display = 'none';
            document.getElementById('tela_resultado').style.display = 'none';
            document.getElementById('tela_ajuda').style.display = 'none';
            mostrarMensagem('Bem-vindo! Clique em JOGAR');
        }

        function comecarJogo() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('tela_jogo').style.display = 'block';
            document.getElementById('tela_resultado').style.display = 'none';
            document.getElementById('tela_ajuda').style.display = 'none';
            
            jogo.pontos_jogador = 0;
            jogo.pontos_ia = 0;
            jogo.turno = 'jogador';
            jogo.jogo_terminado = false;
            jogo.peca_selecionada = null;
            jogo.movimentos_validos = [];
            jogo.pecas_jogador_vencidas = 0;
            jogo.pecas_ia_vencidas = 0;
            
            criarTabuleiro();
            criarPecas();
            mostrarMensagem('‚úì Clique em uma pe√ßa AZUL para come√ßar!');
            atualizarUI();
        }

        function criarTabuleiro() {
            const tabuleiro = document.getElementById('tabuleiro');
            tabuleiro.innerHTML = '';
            jogo.hexagons = [];

            for (let linha = 0; linha < 6; linha++) {
                for (let coluna = 0; coluna < 8; coluna++) {
                    const hex = document.createElement('div');
                    hex.className = 'hex';
                    hex.id = 'hex-' + linha + '-' + coluna;
                    
                    if (ehObstaculo(linha, coluna)) {
                        hex.classList.add('obstaculo');
                        hex.textContent = 'ü™®';
                    } else if (ehDestino(linha, coluna)) {
                        hex.classList.add('destino');
                        hex.textContent = '‚≠ê';
                    }
                    
                    hex.onclick = function() {
                        cliqueBotao(linha, coluna);
                    };

                    tabuleiro.appendChild(hex);
                    jogo.hexagons.push({
                        linha: linha,
                        coluna: coluna,
                        elemento: hex
                    });
                }
            }
        }

        function ehObstaculo(linha, coluna) {
            var obstaculos = [[2,2], [2,5], [3,1], [3,6], [4,3], [1,4]];
            for (var i = 0; i < obstaculos.length; i++) {
                if (obstaculos[i][0] === linha && obstaculos[i][1] === coluna) {
                    return true;
                }
            }
            return false;
        }

        function ehDestino(linha, coluna) {
            return linha < 2 && coluna > 5;
        }

        function criarPecas() {
            jogo.pecas = [];
            
            // Pe√ßas do jogador - com ID √∫nico para rastrear
            jogo.pecas.push({id: 'j1', linha: 5, coluna: 0, dono: 'jogador', protegida: false});
            jogo.pecas.push({id: 'j2', linha: 4, coluna: 0, dono: 'jogador', protegida: false});
            jogo.pecas.push({id: 'j3', linha: 5, coluna: 1, dono: 'jogador', protegida: false});
            
            // Pe√ßas da IA - com ID √∫nico para rastrear
            jogo.pecas.push({id: 'i1', linha: 5, coluna: 7, dono: 'ia', protegida: false});
            jogo.pecas.push({id: 'i2', linha: 4, coluna: 7, dono: 'ia', protegida: false});
            jogo.pecas.push({id: 'i3', linha: 5, coluna: 6, dono: 'ia', protegida: false});
            
            renderizarPecas();
        }

        function renderizarPecas() {
            // Limpar tabuleiro (mas manter obst√°culos e destino)
            for (var i = 0; i < jogo.hexagons.length; i++) {
                var h = jogo.hexagons[i];
                if (!h.elemento.classList.contains('obstaculo')) {
                    if (h.elemento.classList.contains('destino')) {
                        h.elemento.textContent = '‚≠ê';
                    } else {
                        h.elemento.textContent = '';
                    }
                }
            }

            // Desenhar todas as pe√ßas
            for (var i = 0; i < jogo.pecas.length; i++) {
                var peca = jogo.pecas[i];
                var hex = procurarHex(peca.linha, peca.coluna);
                if (hex) {
                    var emoji = peca.dono === 'jogador' ? 'üîµ' : 'üî¥';
                    
                    // Se est√° no destino, mostrar ambos
                    if (ehDestino(peca.linha, peca.coluna)) {
                        hex.textContent = '‚≠ê' + emoji;
                    } else {
                        hex.textContent = emoji;
                    }
                }
            }
        }

        function procurarHex(linha, coluna) {
            for (var i = 0; i < jogo.hexagons.length; i++) {
                if (jogo.hexagons[i].linha === linha && jogo.hexagons[i].coluna === coluna) {
                    return jogo.hexagons[i].elemento;
                }
            }
            return null;
        }

        function procurarPecaEm(linha, coluna) {
            for (var i = 0; i < jogo.pecas.length; i++) {
                var p = jogo.pecas[i];
                if (p.linha === linha && p.coluna === coluna) {
                    return p;
                }
            }
            return null;
        }

        function cliqueBotao(linha, coluna) {
            if (jogo.jogo_terminado) return;
            
            if (jogo.turno !== 'jogador') {
                mostrarMensagem('‚ùå N√£o √© sua vez!');
                return;
            }

            var peca = procurarPecaEm(linha, coluna);

            if (peca && peca.dono === 'jogador') {
                selecionarPeca(peca);
                return;
            }

            if (jogo.peca_selecionada && ehMovimentoValido(linha, coluna)) {
                moverPeca(jogo.peca_selecionada, linha, coluna);
                return;
            }

            mostrarMensagem('‚ùå Movimento inv√°lido!');
        }

        function selecionarPeca(peca) {
            jogo.peca_selecionada = peca;
            jogo.movimentos_validos = obterMovimentosValidos(peca);

            for (var i = 0; i < jogo.hexagons.length; i++) {
                jogo.hexagons[i].elemento.classList.remove('valido');
            }

            for (var i = 0; i < jogo.movimentos_validos.length; i++) {
                var mov = jogo.movimentos_validos[i];
                var hex = procurarHex(mov.linha, mov.coluna);
                if (hex && !hex.classList.contains('obstaculo')) {
                    hex.classList.add('valido');
                }
            }

            mostrarMensagem('‚úì Pe√ßa selecionada! ' + jogo.movimentos_validos.length + ' movimentos');
        }

        function obterMovimentosValidos(peca) {
            var movimentos = [];
            var direcoes = [[0,1], [0,-1], [1,0], [-1,0], [1,-1], [-1,1]];

            for (var distancia = 1; distancia <= 3; distancia++) {
                for (var d = 0; d < direcoes.length; d++) {
                    var dir = direcoes[d];
                    var novaLinha = peca.linha + dir[0] * distancia;
                    var novaColuna = peca.coluna + dir[1] * distancia;

                    if (novaLinha >= 0 && novaLinha < 6 && novaColuna >= 0 && novaColuna < 8) {
                        if (!ehObstaculo(novaLinha, novaColuna)) {
                            movimentos.push({linha: novaLinha, coluna: novaColuna});
                        }
                    }
                }
            }

            return movimentos;
        }

        function ehMovimentoValido(linha, coluna) {
            for (var i = 0; i < jogo.movimentos_validos.length; i++) {
                if (jogo.movimentos_validos[i].linha === linha && jogo.movimentos_validos[i].coluna === coluna) {
                    return true;
                }
            }
            return false;
        }

        function moverPeca(peca, novaLinha, novaColuna) {
            // Verificar captura (s√≥ captura pe√ßas N√ÉO protegidas)
            var capturada = procurarPecaEm(novaLinha, novaColuna);
            if (capturada && capturada.dono !== peca.dono && !capturada.protegida) {
                var index = jogo.pecas.indexOf(capturada);
                if (index > -1) {
                    jogo.pecas.splice(index, 1);
                    jogo.pontos_jogador += 100;
                    mostrarMensagem('üéØ Captura! +100 pontos!');
                }
            }

            // Guardar localiza√ß√£o antiga ANTES de mover
            var estavaNoDestino = ehDestino(peca.linha, peca.coluna);

            // Mover pe√ßa
            peca.linha = novaLinha;
            peca.coluna = novaColuna;

            // Verificar se chegou ao destino (e ainda n√£o estava l√°!)
            if (ehDestino(peca.linha, peca.coluna) && peca.dono === 'jogador' && !estavaNoDestino && !peca.protegida) {
                peca.protegida = true;
                jogo.pecas_jogador_vencidas++;
                jogo.pontos_jogador += 500;
                mostrarMensagem('‚≠ê Uma pe√ßa chegou ao destino! +500 pontos! (' + jogo.pecas_jogador_vencidas + '/3)');
            }

            // Limpar sele√ß√£o
            for (var i = 0; i < jogo.hexagons.length; i++) {
                jogo.hexagons[i].elemento.classList.remove('valido');
            }
            jogo.peca_selecionada = null;

            renderizarPecas();

            if (verificarVitoria()) {
                return;
            }

            jogo.turno = 'ia';
            atualizarUI();
            mostrarMensagem('ü§ñ Vez da IA...');
            setTimeout(turnoIA, 1500);
        }

        function turnoIA() {
            if (jogo.jogo_terminado) return;
            if (jogo.turno !== 'ia') return;

            var pecsIA = jogo.pecas.filter(p => p.dono === 'ia');

            if (pecsIA.length === 0) {
                jogo.turno = 'jogador';
                atualizarUI();
                mostrarMensagem('‚úì Sua vez! Clique em uma pe√ßa AZUL');
                return;
            }

            var melhorMovimento = null;
            var melhorScore = -9999;

            for (var p = 0; p < pecsIA.length; p++) {
                var peca = pecsIA[p];
                var movimentos = obterMovimentosValidos(peca);

                for (var m = 0; m < movimentos.length; m++) {
                    var mov = movimentos[m];
                    var score = 50 - Math.abs(mov.linha - 0) - Math.abs(mov.coluna - 7);

                    // B√¥nus GRANDE se chegar√° ao destino
                    if (ehDestino(mov.linha, mov.coluna) && !peca.protegida) {
                        score += 10000;
                    }

                    var alvo = procurarPecaEm(mov.linha, mov.coluna);
                    if (alvo && alvo.dono === 'jogador' && !alvo.protegida) {
                        score += 500;
                    }

                    if (score > melhorScore) {
                        melhorScore = score;
                        melhorMovimento = {peca: peca, linha: mov.linha, coluna: mov.coluna};
                    }
                }
            }

            if (melhorMovimento) {
                // Guardar se estava no destino ANTES
                var estavaNoDestino = ehDestino(melhorMovimento.peca.linha, melhorMovimento.peca.coluna);

                // Capturar se houver
                var capturada = procurarPecaEm(melhorMovimento.linha, melhorMovimento.coluna);
                if (capturada && capturada.dono === 'jogador' && !capturada.protegida) {
                    var index = jogo.pecas.indexOf(capturada);
                    if (index > -1) {
                        jogo.pecas.splice(index, 1);
                        jogo.pontos_ia += 100;
                        mostrarMensagem('ü§ñ IA capturou uma pe√ßa! +100 pontos IA');
                    }
                }

                // Mover
                melhorMovimento.peca.linha = melhorMovimento.linha;
                melhorMovimento.peca.coluna = melhorMovimento.coluna;

                // Se chegou ao destino e ainda n√£o estava l√°
                if (ehDestino(melhorMovimento.peca.linha, melhorMovimento.peca.coluna) && !estavaNoDestino && !melhorMovimento.peca.protegida) {
                    melhorMovimento.peca.protegida = true;
                    jogo.pecas_ia_vencidas++;
                    jogo.pontos_ia += 500;
                    mostrarMensagem('ü§ñ IA: Uma pe√ßa chegou ao destino! (' + jogo.pecas_ia_vencidas + '/3)');
                }

                renderizarPecas();

                if (verificarVitoria()) {
                    return;
                }
            }

            jogo.turno = 'jogador';
            atualizarUI();
            mostrarMensagem('‚úì Sua vez! Clique em uma pe√ßa AZUL');
        }

        function verificarVitoria() {
            if (jogo.pecas_jogador_vencidas >= 3) {
                finalizarJogo('vitoria', 'Voc√™ conquistou a gal√°xia! üèÜ');
                return true;
            }

            if (jogo.pecas_ia_vencidas >= 3) {
                finalizarJogo('derrota', 'A IA conquistou a gal√°xia primeiro! üò¢');
                return true;
            }

            var pecasJogadorAtivas = jogo.pecas.filter(p => p.dono === 'jogador').length;
            var pecasIAAtivas = jogo.pecas.filter(p => p.dono === 'ia').length;

            if (pecasJogadorAtivas === 0 && jogo.pecas_jogador_vencidas < 3) {
                finalizarJogo('derrota', 'Todas suas pe√ßas foram capturadas! üò¢');
                return true;
            }

            if (pecasIAAtivas === 0 && jogo.pecas_ia_vencidas < 3) {
                finalizarJogo('vitoria', 'Voc√™ capturou todas as pe√ßas da IA! üèÜ');
                return true;
            }

            return false;
        }

        function finalizarJogo(resultado, mensagem) {
            jogo.jogo_terminado = true;
            
            document.getElementById('tela_jogo').style.display = 'none';
            document.getElementById('tela_resultado').style.display = 'block';

            if (resultado === 'vitoria') {
                document.getElementById('titulo_resultado').textContent = 'üèÜ VIT√ìRIA!';
                document.getElementById('titulo_resultado').style.color = '#00ff41';
            } else {
                document.getElementById('titulo_resultado').textContent = 'üò¢ DERROTA';
                document.getElementById('titulo_resultado').style.color = '#ff006e';
            }

            document.getElementById('texto_resultado').innerHTML = '<strong>' + mensagem + '</strong><br><br>Seus Pontos: ' + jogo.pontos_jogador + '<br>Pontos da IA: ' + jogo.pontos_ia;

            mostrarMensagem('Jogo finalizado!');
        }

        function atualizarUI() {
            document.getElementById('pontos').textContent = jogo.pontos_jogador;
            document.getElementById('pontos_ia').textContent = jogo.pontos_ia;
            document.getElementById('vencidas_jogador').textContent = jogo.pecas_jogador_vencidas;
            document.getElementById('vencidas_ia').textContent = jogo.pecas_ia_vencidas;
            document.getElementById('turno').textContent = jogo.turno === 'jogador' ? 'VOC√ä' : 'IA ü§ñ';
        }
    </script>
</body>
</html>
